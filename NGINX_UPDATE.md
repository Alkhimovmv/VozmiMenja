# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Nginx –¥–ª—è PageSpeed –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ nginx-vozmimenya.conf

### 1. Gzip —Å–∂–∞—Ç–∏–µ
- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ 70-80%** –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°–∂–∞—Ç–∏–µ CSS, JS, JSON, SVG, —à—Ä–∏—Ñ—Ç–æ–≤
- `gzip_comp_level 6` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏/—Å–∂–∞—Ç–∏—è

### 2. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### `/assets/` (Vite —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)
```nginx
Cache-Control: public, max-age=31536000, immutable
```
- 1 –≥–æ–¥ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `immutable` - –±—Ä–∞—É–∑–µ—Ä –ù–ï –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ñ–∞–π–ª—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω—ã)
- `access_log off` - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏

#### `/uploads/` (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è)
```nginx
Cache-Control: public, max-age=31536000, immutable
```
- 1 –≥–æ–¥ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

#### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (fonts, icons)
```nginx
Cache-Control: public, max-age=31536000, immutable
```

### 3. –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```nginx
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

### 4. WebP –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑–¥–∞—á–∏ .webp –≤–µ—Ä—Å–∏–π
- –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebP, –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å—Å—è .webp –≤–º–µ—Å—Ç–æ .jpg/.png

---

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```bash
cd /home/maxim/VozmiMenja/client
npm run build
```

### –®–∞–≥ 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
# –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ scp:
scp -r dist/* user@server:/var/www/html/vozmimenya.ru/

# –ò–ª–∏ –µ—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
cp -r dist/* /var/www/html/vozmimenya.ru/
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
```bash
# –ö–æ–ø–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cp /home/maxim/VozmiMenja/nginx-vozmimenya.conf /etc/nginx/sites-available/vozmimenya

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
sudo nginx -t
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
```bash
sudo systemctl reload nginx
# –∏–ª–∏
sudo systemctl restart nginx
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
sudo systemctl status nginx
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
curl -I https://vozmimenya.ru/assets/index-abc123.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
HTTP/1.1 200 OK
Content-Type: application/javascript
Cache-Control: public, max-age=31536000, immutable
Content-Encoding: gzip
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Gzip —Å–∂–∞—Ç–∏—è
```bash
curl -H "Accept-Encoding: gzip" -I https://vozmimenya.ru/assets/index-abc123.js
```

–î–æ–ª–∂–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
Content-Encoding: gzip
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–∂–∞—Ç–∏—è
```bash
# –ë–µ–∑ —Å–∂–∞—Ç–∏—è
curl https://vozmimenya.ru/assets/index-abc123.js | wc -c

# –°–æ —Å–∂–∞—Ç–∏–µ–º
curl -H "Accept-Encoding: gzip" https://vozmimenya.ru/assets/index-abc123.js | wc -c
```

–†–∞–∑–º–µ—Ä —Å–æ —Å–∂–∞—Ç–∏–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 70-80% –º–µ–Ω—å—à–µ.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PageSpeed

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞:

1. **Google PageSpeed Insights**
   - https://pagespeed.web.dev/
   - –í–≤–µ–¥–∏—Ç–µ: `https://vozmimenya.ru`

2. **GTmetrix**
   - https://gtmetrix.com/
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

3. **WebPageTest**
   - https://www.webpagetest.org/
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **Performance Score** | 70-80 | 90+ | +20-30 |
| **LCP** | 2.5-3s | 1.0-1.5s | 40-60% |
| **CLS** | 0.1-0.2 | <0.05 | ~90% |
| **–†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã** | 2.5 MB | 0.7-1.0 MB | 60-70% |
| **–ö–µ—à –ø–æ–ø–∞–¥–∞–Ω–∏—è** | 10 –º–∏–Ω | 1 –≥–æ–¥ | 52,560x |

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –í–∫–ª—é—á–µ–Ω–∏–µ Brotli (–µ—Å–ª–∏ –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω)
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–æ–¥—É–ª—è
nginx -V 2>&1 | grep brotli

# –ï—Å–ª–∏ –º–æ–¥—É–ª—å –µ—Å—Ç—å, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
# brotli on;
# brotli_comp_level 6;
# brotli_types ...
```

Brotli –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–Ω–∞ 20% –ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ** —á–µ–º Gzip.

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ WebP
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cwebp
sudo apt install webp

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
cd /var/www/vozmimenya/server/uploads
find . -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" | while read file; do
    cwebp -q 85 "$file" -o "${file%.*}.webp"
done
```

–≠–∫–æ–Ω–æ–º–∏—è: **~50-70% —Ä–∞–∑–º–µ—Ä–∞** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å JPEG/PNG.

---

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
sudo cp /etc/nginx/sites-available/vozmimenya.backup /etc/nginx/sites-available/vozmimenya
sudo nginx -t
sudo systemctl reload nginx
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ Nginx
```bash
# Access –ª–æ–≥
tail -f /var/log/nginx/vozmimenya-access.log

# Error –ª–æ–≥
tail -f /var/log/nginx/vozmimenya-error.log
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ /assets/ (–¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è)
grep "/assets/" /var/log/nginx/vozmimenya-access.log | wc -l
```

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`npm run build`)
- [ ] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ nginx-vozmimenya.conf
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`nginx -t`)
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ Cache-Control
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ Gzip —Å–∂–∞—Ç–∏—è
- [ ] –¢–µ—Å—Ç –Ω–∞ PageSpeed Insights
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ (–ø–µ—Ä–≤—ã–µ 5-10 –º–∏–Ω—É—Ç)

---

**–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ [nginx-vozmimenya.conf](nginx-vozmimenya.conf)**

–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é! üöÄ
