# Обновление: Админ-панель и новая система цен

## Что нового

### 1. Убрана надпись "В наличии"
Из карточек оборудования на главной странице убрана строка "В наличии: X из Y"

### 2. Новая система ценообразования
Теперь поддерживаются разные цены в зависимости от срока аренды:
- 1-2 дня
- 3 дня
- 7 дней (неделя)
- 14 дней (2 недели)
- 30 дней (месяц)

### 3. Админ-панель
Добавлена полноценная админ-панель с возможностью:
- Просмотра всего оборудования
- Добавления нового оборудования
- Редактирования существующего
- Удаления оборудования
- Управления ценами для разных периодов аренды

## Установка и запуск

### Первый запуск (миграция базы данных)

Если у вас уже есть существующая база данных:

```bash
# Перейдите в папку сервера
cd server

# Запустите миграцию
npm run migrate
```

Если вы начинаете с нуля:

```bash
# Сервер
cd server
npm install
npm run dev

# Клиент (в новом терминале)
cd client
npm install
npm run dev
```

### Доступ к админ-панели

1. Откройте браузер и перейдите по адресу: `http://localhost:5173/admin/login`
2. Введите пароль: **20031997**
3. Вы попадете на панель администратора

## Использование админ-панели

### Добавление нового оборудования

1. На странице админ-панели нажмите кнопку **"Добавить оборудование"**
2. Заполните форму:
   - Название
   - Категория
   - Описание
   - Цены для разных периодов (1-2 дня, 3 дня, 7 дней, 14 дней, месяц)
   - Общее количество
   - Доступно для аренды
   - URL изображений (можно добавить несколько)
3. Нажмите **"Сохранить"**

### Редактирование оборудования

1. В таблице оборудования найдите нужную позицию
2. Нажмите **"Редактировать"**
3. Внесите изменения в форме
4. Нажмите **"Сохранить"**

### Удаление оборудования

1. В таблице оборудования найдите нужную позицию
2. Нажмите **"Удалить"**
3. Подтвердите удаление

## Структура проекта

### Новые файлы (клиент)

- `client/src/pages/AdminLoginPage.tsx` - страница входа для админа
- `client/src/pages/AdminDashboardPage.tsx` - главная страница админ-панели
- `client/src/components/admin/EquipmentForm.tsx` - форма для добавления/редактирования оборудования

### Новые файлы (сервер)

- `server/src/routes/admin.ts` - API маршруты для админ-панели
- `server/src/scripts/migrate-pricing.ts` - скрипт миграции базы данных

### Измененные файлы

#### Клиент:
- `client/src/types/index.ts` - добавлен интерфейс PricingTier
- `client/src/lib/api.ts` - добавлены методы для работы с админ-панелью
- `client/src/App.tsx` - добавлены маршруты для админ-панели
- `client/src/components/equipment/EquipmentCard.tsx` - убрана надпись "В наличии"

#### Сервер:
- `server/src/models/database.ts` - обновлена схема таблицы equipment
- `server/src/models/Equipment.ts` - добавлены методы update и delete, поддержка pricing
- `server/src/index.ts` - добавлен роут для админ-панели

## API эндпоинты

### Админ-панель

```
POST   /api/admin/login              - Вход в админ-панель
POST   /api/admin/equipment          - Создать оборудование (требуется авторизация)
PUT    /api/admin/equipment/:id      - Обновить оборудование (требуется авторизация)
DELETE /api/admin/equipment/:id      - Удалить оборудование (требуется авторизация)
```

## Безопасность

⚠️ **Важно для production:**

1. Измените пароль администратора в файле `server/src/routes/admin.ts`
2. Используйте переменные окружения для хранения пароля
3. Реализуйте полноценную JWT-авторизацию вместо простого токена
4. Добавьте HTTPS
5. Добавьте rate limiting для защиты от брутфорса

## Troubleshooting

### База данных не обновляется

Если после миграции база данных не обновилась:
1. Остановите сервер
2. Удалите файл `server/database.sqlite`
3. Запустите сервер заново - база данных создастся автоматически с новой схемой
4. Запустите `npm run seed` для добавления тестовых данных

### Ошибка авторизации в админ-панели

Убедитесь, что:
1. Сервер запущен
2. Вы используете правильный пароль: **20031997**
3. В консоли браузера нет ошибок CORS

### Не сохраняются изменения

Проверьте:
1. Консоль браузера на наличие ошибок
2. Логи сервера
3. Что токен авторизации сохранен в localStorage
